<style type="text/css">
    #goodsAdd2{
        position: absolute;
        z-index: 100;
        width: 1200px;
        overflow: hidden;
    }
    .win_column{
        margin-top: -20px;
        border: solid 1px #50D1DE;
        height: 600px;
        overflow: auto;
    }
    .win_column_head{
        background-color: #80E5F0;
        text-align: center;
        overflow: hidden;
        height: 30px;
        line-height: 30px;
        font-weight: bold;
        font-size: 25px;
    }
    .goods_price{
        float: left;
        width: 410px;
    }
    .goods_all{
        float: right;
        width: 780px;
    }
    .goods_price_li{
        width: 100%;
        overflow: hidden;
    }
    .goods_price_head{
        width: 80px;
        text-align: right;
        float: left;
        color: #07A1B1;
        font-size: 15px;
        display: block;
        height: 50px;
        line-height: 50px;
    }
    .goods_price_con{
        border: 1px solid #50D1DE;
        margin: 7px 0 10px 5px;
        padding: 3px 0 0 3px;
        width: 300px;
        float: left;
    }
    .goods_price_con_li{
        width: 70px;
        height: 30px;
        line-height: 30px;
        border: 1px solid #50D1DE;
        margin: 0 3px 3px 0;
        float: left;
        text-align: center;
    }
    .goods_price_con_li:hover{
        cursor: pointer;
        background-color: #50D1DE;
    }
    .goods_price_con_li_click{
        background-color: #50D1DE;
        color:red;
    }

    .goods_price_con_info{
        display: none;
        width: 380px;
        overflow: hidden;
        margin: 5px auto;
        border: 1px solid #50D1DE;
        padding: 2px 0 0 2px;
    }
    .goods_price_con_info >div{
        float: left;
        margin: 0 2px 2px 0;
        border: 1px solid #50D1DE;
        overflow: hidden;
        height: 50px;
    }
    .goods_price_con_info >div.goods_price_con_list{
        width: 236px;
        border: hidden;
        height:auto;
        margin: 0;
    }
    .goods_price_con_prop{
        float: left;
        width: 43px;
        height: 50px;
        border: 1px solid #50D1DE;
        margin: 0 5px 5px 0;
        overflow: hidden;
    }
    .goods_td{
        width: 100%;
        height: 25px;
        text-align: center;
        line-height: 25px;
        border-bottom: 1px solid #50D1DE;
    }
    .goods_price_con_prop_select{
        border-bottom: 1px solid red;
    }
    .goods_price_con_prop_name{

    }
    .goods_price_con_sum{
        width: 40px;
    }
    .numbers{
        width: 40px;
        font-size: 9px;
    }
    .goods_price_con_price{
        width: 40px;
    }
    .goods_price_con_img{
        height: 50px;
        width: 50px;
    }
    #goods_price_default{
        display: block;
    }
</style>
<form action="./server/goodsAdd2Ser.php" method="post" id="goodsAdd2Form">
    <div id='goodsAdd2' class='win show_win'>
        <input type="hidden" name="g_id" id="g_id" value="<{$g_id}>" />
        <h1 class="win_head">添加商品详细资料 <div class="show_win_close">×</div></h1>
        <div class="win_column goods_price">
            <div class ="win_column_head">商品详细价格</div>
            <{foreach $gp as $value}>
            <div class='goods_price_li'>
                <label class='goods_price_head' gtp_id ="<{$value['gtp_id']}>"><{$value['gtp_name']}></label>
                <div class='goods_price_con'>
                    <{foreach $value['gp_value'] as $v}>
                    <div class='goods_price_con_li' gp_id="<{$v['gp_id']}> "><{$v['gp_name']}></div>
                    <{/foreach}>
                </div>
            </div>
            <{/foreach}>
            <div class="goods_price_con_info" id="goods_price_default">
                <div class="goods_price_con_list">
                    默认价格
                </div>
                <div class="goods_price_con_sum">
                    <div class="goods_td">数量</div>
                    <div class="goods_td"></div>
                </div>
                <div class="goods_price_con_price">
                    <div class="goods_td">价格</div>
                    <div class="goods_td"><{$g_price}></div>
                </div>
                <div class="goods_price_con_img">
                    <img src="<{$g_img}>?imageView2/5/w/75/h/75" />
                </div>
            </div>
            <div class="goods_price_con_info" id="goods_price_con_info_parents">
                <div class="goods_price_con_list">
                </div>
                <div class="goods_price_con_sum">
                    <div class="goods_td">数量</div>
                    <div class="goods_td"><input class="numbers" type="number" min="0" name="sum" value="0" ></div>
                </div>
                <div class="goods_price_con_price">
                    <div class="goods_td">价格</div>
                    <div class="goods_td"><input class="numbers" type="number" name="sum" ></div>
                </div>
                <div class="goods_price_con_img">
                </div>
            </div>
        </div>
        <div class="win_column goods_all">
            <div class ="win_column_head">商品详细介绍</div>
        </div>
    </div>
</form>
<script>
    $(function (){
        $('.goods_price_con_li').click(function(){
            if(!$(this).hasClass('goods_price_con_li_click')){
                $(this).addClass('goods_price_con_li_click');
                $(this).siblings().removeClass('goods_price_con_li_click');
                $(".goods_price_con_prop[gp_id='"+$(this).attr('gp_id')+"']").addClass('goods_price_con_prop_select');
                var gp_ids = [];
                var prop = $('.goods_price_con_list');
                $('.goods_price_con_li_click').map(function(){
                    gp_ids.push($(this).attr('gp_id'));
                    prop = prop.children(".goods_price_con_prop[gp_id='"+$(this).attr('gp_id')+"']").parent();
                });
                var gp_create = false;
                $('.goods_price_con_info').each(function(){
                    var gp = $(this).find('.goods_price_con_prop');
                    var gps =  gp.map(function(){return $(this).attr('gp_id'); }).get();
                    if(gps.sort().toString() == gp_ids.sort().toString()){
                        gp_create =true;
                        return false;
                    }
//                    if(gps[0] != null){
//
//                        var c = true;
//                        for(var i in gp_ids ){
//                            if($.inArray(gp_ids[i],gps) == -1){
//                                c = false;
//                                break;
//                            }
//                        }
//                        if(c){
//                            gp_create = true;
//                            return false;
//                        }
//                    }
                });
                if(!gp_create){
                    if($('#goods_price_con_info_add').length ==0){
                        var a = $('#goods_price_con_info_parents').clone();
                        for(var gp_id in gp_ids){
                            var gp_li = $(".goods_price_con_li[gp_id='"+gp_ids[gp_id]+"']");
                            var gp_name = gp_li.html();
                            var gtp_id = gp_li.parent().siblings('.goods_price_head').attr('gtp_id');
                            var gtp_name = gp_li.parent().siblings('.goods_price_head').html();
                            a.children('.goods_price_con_list').append(" <div class='goods_price_con_prop' gtp_id='"+gtp_id+"' gp_id='"+gp_ids[gp_id]+"'><div class='goods_td goods_price_con_prop_name'>"+gtp_name+"</div> <div class='goods_td goods_price_con_prop_value'>"+gp_name+"</div> </div>");
                            a.attr('id','goods_price_con_info_add');
                            a.appendTo($('.goods_price'));
                            a.show();
                        }
                    }else{
                        var gtp_id = $(this).parent().siblings('.goods_price_head').attr('gtp_id');
                        var gtp_name = $(this).parent().siblings('.goods_price_head').html();
                        var self = $(this);
                        var b = true;
                        $('#goods_price_con_info_add>.goods_price_con_list>.goods_price_con_prop').each(function(){
                            if(gtp_id ==$(this).attr('gtp_id')){
                                b = false;
                                $(this).attr('gp_id',self.attr('gp_id'));
                                $(this).children('.goods_price_con_prop_value').html(self.html());
                            }
                        });
                        if(b){
                            $('#goods_price_con_info_add>.goods_price_con_list').append(" <div class='goods_price_con_prop' gtp_id='"+gtp_id+"' gp_id='"+$(this).attr('gp_id')+"'><div class='goods_td goods_price_con_prop_name'>"+gtp_name+"</div> <div class='goods_td goods_price_con_prop_value'>"+$(this).html()+"</div> </div>");
                        }
                    }

                }
            }else{
                $(this).removeClass('goods_price_con_li_click');
               // $(".goods_price_con_prop[gp_id='"+$(this).attr('gp_id')+"']").removeClass('goods_price_con_prop_select');

                $("#goods_price_con_info_add>.goods_price_con_list>.goods_price_con_prop[gp_id='"+$(this).attr('gp_id')+"']").remove();
                if($("#goods_price_con_info_add>.goods_price_con_list>.goods_price_con_prop").length ==0){
                    $("#goods_price_con_info_add").remove();
                }

            }

        });
    });
    $(function(){
        //上传头像
        var up = getUpload();
        up.browse_button = "imgUp";
        //up.container = "adminHeadImg";
        up['init'].UploadProgress = function(up,file){
            $("#bar").css("width",file.percent+"%");
        };
        up['init'].FileUploaded = function (up, file, info) {
            var domain = up.getOption('domain');
            var res = JSON.parse(info);
            $("#adminHeadImg>img").attr("src", domain + "/" + res.key + "?imageView2/5/w/75/h/75");
            $("#adminHeadImg>input[name='img']").val(domain + "/" + res.key);
            $("#bar").css("background-color","#50D1DE");
        };
        var uploader = Qiniu.uploader(up);
    });
</script>
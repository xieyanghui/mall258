<style type="text/css">
    #adminAdd{
        position: absolute;
        z-index: 100;
        width: 500px;
        overflow: hidden;
    }
</style>
<form action="./server/adminAddSer.php" method="post" id="adminAddForm">
    <div id='adminAdd' class='win show_win'>
        <h1 class="win_head">添加管理员 <div class="show_win_close">×</div></h1>
        <div class="win_row">
            <label class ="win_row_head">登录名</label>
            <div class ="win_row_input"><input tabindex="1" type="text" name="a_name" class="form_div"/></div>
        </div>
        <div class="win_row">
            <label class ="win_row_head">姓名</label>
            <div class ="win_row_input"><input tabindex="2" type="text" name="a_nick" class="form_div"/></div>
        </div>
        <div class="win_row">
            <label class ="win_row_head">密码</label>
            <div class ="win_row_input"><input tabindex="3" type="password" name="a_pwd" class="form_div"/></div>
        </div>
        <div class ="win_row_auto">
            <label class ="win_row_head" >头像</label>
            <div class ="win_row_con">
                <div id="adminHeadImg">
                    <img src="<{$adminHeadDefault}>?imageView2/5/w/75/h/75"/>
                    <input  type="hidden" name="a_img"/>
                </div>
                <div class="uploadImg">
                    <div id="imgUp" class="button">选择图片</div>
                    <div class="bars"><div id="bar"></div></div>
                </div>
            </div>
        </div>
        <div class ="win_row_auto">
            <label class ="win_row_head" >管理员级别</label>
            <div class ="win_row_con">
                <{section name=index loop=$adminAuth}>
                <label title="<{$adminAuth[index]['aa_remark']}>">
                    <input name="aa_id" tabindex="4" type="radio"  value="<{$adminAuth[index]['aa_id']}>" <{if $adminAuth[index]['aa_id'] eq 2 }>checked<{/if}>/>
                    <{$adminAuth[index]['aa_nick']}>
                </label>
                <{/section}>
            </div>
        </div>

        <div class="win_row">
            <div class="button cancel">取消</div>
            <div class="submit button">提交</div>
        </div>
    </div>
</form>
<script>
    function succ(data) {
        toast(data.status, data.megs);
        Resize.resizeF5('./inc/adminInfo.php');
    }
    $(function(){
        //新增管理员提交
        $('.submit').click(function () {
            $(this).parents("form").submit();
        });
        //验证
        $.checks.checkform($('#adminAddForm'),{
            "async": {'success': succ},
            "a_name": {
                "name": "登录名",
                "check": ["noSpechars", {"isLength": [4, 20]}, {"isAjax": ["/server/iskeySer.php"]}]
            },
            "a_nick": {
                "name": "姓名",
                "check": [{"isLength": [2, 20]}]
            },
            "a_pwd": {
                "name": "密码",
                "check": [{"isLength": [6, 20]}]
            }
        });

    });
    $(function(){
        //上传头像
        var up = getUpload();
        up.browse_button = "imgUp";
        up['init'].UploadProgress = function(up,file){
            $("#bar").css("width",file.percent+"%");
        };
        up['init'].FileUploaded = function (up, file, info) {
            var domain = up.getOption('domain');
            var res = JSON.parse(info);
            $("#adminHeadImg>img").attr("src", domain + "/" + res.key + "?imageView2/5/w/75/h/75");
            $("#adminHeadImg>input[name='a_img']").val(domain + "/" + res.key);
            $("#bar").css("background-color","#50D1DE");
        };
        var uploader = Qiniu.uploader(up);
    });
</script>
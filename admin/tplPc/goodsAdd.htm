<style type="text/css">
    .select_div{
        width: 65px;
        height: 30px;
        border: 1px solid #50D1DE;
        text-align: center;
        line-height: 30px;
        background-color: #EEEEEE;
    }
    .select_div_bottom{
        border-bottom: hidden;
    }
    .select_ul{
        display: none;
        position: absolute;
        z-index: 1000;
        overflow: hidden;
        border-top: 1px solid #50D1DE;
        border-left: 1px solid #50D1DE;
        background-color: #FFFFFF;

    }
    .select_li{
        width: 65px;
        height: 30px;
        border-bottom: 1px solid #50D1DE;
        border-right: 1px solid #50D1DE;
        text-align: center;
        line-height: 30px;
        background-color: #EEEEEE;
        float: left;
    }
    .select_li:hover{
        background-color: #50D1DE;
        cursor: pointer;
    }
    .goods_attr_list{
        height: 30px;
        line-height: 30px;
        border: 1px solid #50D1DE;
        margin: 0 2px 2px 0;
        width: 120px;
        float: left;
        overflow: hidden;
    }
    .goods_attr_list>label{
        width: 70px;
        float: right;
    }
    .goods_price_list >label{
        width: 70px;
    }
    .goods_price_list >div.win_row_con{
        width:160px;
        margin-bottom: 3px;
    }
    div.input_label{
        border: 1px solid #50D1DE;
        padding-left: 5px;
        overflow: hidden;
        display: block;
    }
    label#gt_number{
        height: 30px;
        line-height: 30px;
        width: 35px;
        float: left;
        text-align: right;
        display: block;
    }
    input.input_label_value{
        height: 30px;
        line-height: 30px;
        width:40px;
        border: hidden;
        outline:none;
    }
    div.goods_attr_list>input{
        width:40px;
        display: block;
        padding: 5px;
        height: 18px;
        border: hidden;
        outline:none;
        float: right;
    }
    .attr_price{
        width: 250px;
    }
    textarea.con_textarea{
        display: block;
        outline:none;
        border: 1px solid #50D1DE;
        margin: 2px 5px;
        padding: 3px;
        float: left;
        max-width: 150px;
        width: 150px;
    }
</style>
<form action="./server/goodsAddSer.php" method="post" id="goodsAddForm">
    <div id='goodsAdd' class='win'>
        <input type="hidden" name="gt_id" id="gt_id" />
        <h1 class="win_head">商品基本资料</h1>
        <div class="win_row">
            <label class ="win_row_head">商品类型</label>
            <div class ="win_row_input"><div class="select_div">请选择类型</div>
                <ul class="select_ul">
                    <{section name=index loop=$goodsType}>
                        <li class="select_li" value="<{$goodsType[index]['gt_id']}>"><{$goodsType[index]['gt_name']}> </li>
                    <{/section}>
                </ul>
            </div>
        </div>
        <div class="win_row">
            <label class ="win_row_head">商品编号</label>
            <div class ="win_row_input"><div class="input_label" ><label id="gt_number"></label><input tabindex="2" type="text" name="g_number" class="input_label_value"/></div></div>
        </div>
        <div class="win_row">
            <label class ="win_row_head">商品名称</label>
            <div class ="win_row_input"><input tabindex="3" type="text" name="g_name" class="form_div"/></div>
        </div>
        <div class="win_row">
            <label class ="win_row_head">商品默认价格</label>
            <div class ="win_row_input"><input tabindex="4" type="number" name="g_price" class="form_div"/></div>
        </div>

        <div class ="win_row_auto">
            <label class ="win_row_head" >商品预览图</label>
            <div class ="win_row_con">
                <div id="adminHeadImg">
                    <img src="<{$GOODS_IMG_DEFAULT}>?imageView2/5/w/75/h/75"/>
                    <input  type="hidden" name="img"/>
                </div>
                <div class="uploadImg">
                    <div id="imgUp" class="button">选择图片</div>
                    <div class="bars"><div id="bar"></div></div>
                </div>
            </div>
        </div>

        <div class ="win_row_auto">
            <label class ="win_row_head">SEO</label>
            <div class ="win_row_con">
                <div ><label class='row_con_head'>关键字</label><textarea class="con_textarea" name="g_keywords"></textarea></div>
                <div ><label class='row_con_head'>描述</label><textarea class="con_textarea" name="g_description"></textarea></div>
            </div>
        </div>

        <div class ="win_row_auto">
            <label class ="win_row_head" >属性</label>
            <div class ="win_row_con attr_price" id ='attr'>
            </div>
        </div>
        <div class ="win_row_auto">
            <label class ="win_row_head" >价格</label>
            <div class ="win_row_con attr_price" id = 'price'>
            </div>
        </div>
        <div class="win_row">
            <div class="button cancel">取消</div>
            <div class="submit button">NEXT</div>
        </div>
    </div>
</form>
<script>
    function succ(data) {
        toast(data.status, data.megs);
        if(data.status){
            $('#CRUD').load('./inc/goodsAdd2.php',{'g_id':data.g_id,'g_price':$("input[name='g_price']").val(),'g_img':$("input[name='img']").val()},function(){
                Resize.resizeAdd(1200,50);
            });
        }
    }
    $(function(){
        $('.submit').click(function () {
            $(this).parents("form").submit();
        });
        if($('.select_li').length >4){
            $('.select_ul').css('width','268px');
        }
        $('.select_div').parent().mousemove(function(){
            $('.select_ul').show();
            $('.select_div').addClass('select_div_bottom');
        });
        $('.select_div').parent().mouseout(function(){
            $('.select_ul').hide();
            $('.select_div').removeClass('select_div_bottom');
        });
        //选择商品类型
        $('.select_li').click(function(){
            $('.select_div').html($(this).html());
            $('.select_ul').hide();
            $('#attr').children().remove();
            $('#price').children().remove();
            $('#gt_id').val($(this).attr('value'));
            $.getJSON('./server/goodsTypeInfoSer.php',{'gt_id':$(this).attr('value')},function(data){
                $('#gt_number').html(data['gt_number']);
                for(var j in data['attr']){
                    $('#attr').append("<div class='goods_attr_list'><input id='attr"+j+"' name='attr"+j+"' type='text'/><label for='attr"+j+"'  class='row_con_head'>"+data['attr'][j]+"</label></div>");
                }
                for(var i in data['price']){
                    $('#price').append("<div class='goods_price_list'><label class='row_con_head'>"+data['price'][i]+"</label><div class='win_row_con' id='price"+i+"'><div class='con_list_add'>+</div></div></div>");
                }
                $('.con_list_add').unbind();
                $('.con_list_add').click(function(){
                    var name = $(this).parent().attr("id");
                    $(this).before("<div class='con_list_input'><input class='list_form_div' type='text' name='"+name+"[]' ></div>");
                    $(this).prev().children('input').focus();
                });
                $('.input_label_value').focus();
            });

        });
        //验证
        $.checks.checkform($('#goodsAddForm'),{
            "async": {'success': succ,'beforeSend':function(){
                $('.input_label_value').first().val($('#gt_number').html()+$('.input_label_value').first().val());
            }},
            "g_number": {
                "name": "商品编号",
                "check": ["noSpechars", {"isLength": [5,5]}, {"isAjax": ["/server/iskeySer.php"]}]
            },
            "g_name": {
                "name": "商品名称",
                "check": [{"isLength": [2, 20]}]
            },
            "a_pwd": {
                "name": "密码",
                "check": [{"isLength": [6, 20]}]
            }
        });

    });
    $(function(){
        //上传头像
        var up = getUpload();
        up.browse_button = "imgUp";
        //up.container = "adminHeadImg";
        up['init'].UploadProgress = function(up,file){
            $("#bar").css("width",file.percent+"%");
        };
        up['init'].FileUploaded = function (up, file, info) {
            var domain = up.getOption('domain');
            var res = JSON.parse(info);
            $("#adminHeadImg>img").attr("src", domain + "/" + res.key + "?imageView2/5/w/75/h/75");
            $("#adminHeadImg>input[name='img']").val(domain + "/" + res.key);
            $("#bar").css("background-color","#50D1DE");
        };
        var uploader = Qiniu.uploader(up);
    });
</script>
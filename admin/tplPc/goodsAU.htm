<link rel="stylesheet" href="<{$HTTP_MODEL}>/css/goodsAU.min.css" type="text/css">
<form action="<{$HTTP_MODEL}>/server/goodsAUSer.php" method="post" id="goodsAUForm">
    <div id='goodsAU' class='win'>
        <input type="hidden" name="g_id" id="g_id" value="<{$goods['g_id']|default:''}>" />
        <input type="hidden" name="gt_id" id="gt_id" />
        <input type="hidden" name="g_img" id="g_img" />

        <h1 class="win_head">商品基本资料</h1>
        <div class="win_column">
            <div class="win_row win_row_one">
                <label class ="win_row_head">商品类型</label>
                <div class ="win_row_select">
                    <{if !empty($goods) }>
                    <div class="select_div"><{$goods['gt_name']}></div>
                    <{else}>
                    <div class="select_div">请选择类型</div>
                    <ul class="select_ul">
                        <{section name=index loop=$goodsType}>
                        <li class="select_li" value="<{$goodsType[index]['gt_id']}>"><{$goodsType[index]['gt_name']}> </li>
                        <{/section}>
                    </ul>
                    <{/if}>
                </div>
            </div>
            <div class="win_row">
                <label class ="win_row_head">商品编号</label>
                <div class ="win_row_input">
                    <{if !empty($goods) }>
                    <input  type="hidden" name="g_number" value="<{$goods['g_number']}>"/>
                    <div class="input_label g_number" ><{$goods['g_number']}></div>
                    <{else}>
                    <div class="win_row_input"  ><input tabindex="2" type="text" name="g_number" class="form_div"/></div>
                    <{/if}>
                </div>
            </div>
            <div class="win_row">
                <label class ="win_row_head">商品名称</label>
                <div class ="win_row_input"><input tabindex="3"   type="text" name="g_name" class="form_div" value="<{$goods['g_name']|default:'' }>"/></div>
            </div>
            <div class="win_row">
                <label class ="win_row_head">商品默认价格</label>
                <div class ="win_row_input"><input tabindex="4" type="number" name="g_price" class="form_div" value="<{$goods['g_price']|default:'' }>" /></div>
            </div>

            <div class ="win_row_auto">
                <label class ="win_row_head">商品预览图</label>
                <div class ="win_row_con">
                    <div class="upload_img_div">
                        <img preview=".upload_img_div >img" class="preview_img select_img img_75" img_url="<{$goods['g_img']|default:''}>"  src="<{$goods['g_img']|default:$GOODS_IMG_DEFAULT}>?imageView2/5/w/75/h/75"/>
                    </div>
                    <div class="upload_img_button button select_img" preview=".upload_img_div >img">选择图片</div>
                </div>
            </div>

            <div class ="win_row_auto">
                <label class ="win_row_head">SEO</label>
                <div class ="win_row_con">
                    <div ><label class='row_con_head'>关键字</label><textarea class="con_textarea"  name="g_keywords"><{$goods['g_keywords']|default:''}></textarea></div>
                    <div ><label class='row_con_head'>描述</label><textarea class="con_textarea" name="g_description"><{$goods['g_description']|default:''}></textarea></div>
                </div>
            </div>
        </div>

        <div class="win_column">
        <div class ="win_row_auto win_row_one">
            <label class ="win_row_head" >属性</label>
            <div class ="win_row_con attr_price" id ='attr'>
                <{if !empty($goods['attr']) }>
                <{foreach $goods['attr'] as $attr}>
                <div class='goods_attr_list'>
                    <input name="attr<{$attr['gta_id']}>" id="attr<{$attr['gta_id']}>" value="<{$attr['ga_value']}>" type='text'/>
                    <label class='row_con_head' for="attr<{$attr['gta_id']}>" ><{$attr['gta_name']}></label>
                </div>
                <{/foreach}>
                <{/if}>
            </div>
        </div>
        <div class ="win_row_auto">
            <label class ="win_row_head" >价格</label>
            <div class ="win_row_con attr_price" id = 'price'>
                <{if !empty($goods['price'])}>
                <{foreach $goods['price'] as $price}>
                <div class='goods_price_list' >
                    <label class='row_con_head'><{$price['gtp_name']}></label>
                    <div class='win_row_con' id="price<{$price['gtp_id']}>">
                        <{foreach $price['val'] as $prices}>
                        <div class='con_list_input' >
                            <input class='list_form_div' type='text' value="<{$prices['gp_name']}>" name='u_price<{$prices["gp_id"]}>' />
                        </div>
                        <{/foreach}>
                        <div class='con_list_add'>+</div>

                    </div>
                </div>
                <{/foreach}>
                <{/if}>
            </div>
        </div>
            </div>
        <div class="win_row">
            <div class="left_button history_back">取消</div>
            <div class="right_button submit">NEXT</div>
        </div>
    </div>
</form>
<div class='goods_attr_list' id = 'goods_attr_list_template'>
    <input type='text'/>
    <label class='row_con_head'></label>
</div>
<div class='goods_price_list' id='goods_price_list_template'>
    <label class='row_con_head'></label>
    <div class='win_row_con'>
        <div class='con_list_add'>+</div>
    </div>
</div>

<div id="con_list_input_template" class='con_list_input' >
    <input class='list_form_div' type='text' name='' />
</div>
<script>

    $(function(){
        $('#goodsAU').on('click','.con_list_add',function(){
            var name = $(this).parent().attr("id");
            var price = $('#con_list_input_template').clone();
            price.attr('id','');
            price.children('input').attr('name','a_'+name+'[]');
            $(this).before(price);
            $(this).prev().children('input').focus();
        });


        //验证
        var su = function(data){
            history.pushState({foo:'bar'},"aaa",'<{$HTTP_MODEL}>/view/goodsAU2.php?g_id='+data.g_id);
            if(data.status){
                $('#contents').load('<{$HTTP_MODEL}>/view/goodsAU2.php?g_id='+data.g_id);
            }else{
                toast(data.status,data.megs);
            }
        };
        $.checks.checkform($('#goodsAUForm'),{
            "async": {'success': su,'beforeSend':function(){
                $("input[name='g_img']").val($('.upload_img_div >img').attr('img_url'));
            }},
            "g_numbers": {
                "name": "商品编号",
                "check": ["noSpechars", {"isLength": [5,5]}, {"isAjax": ["<{$HTTP_HOST}>/server/iskeySer.php"]}],
                'location':'number_megs'
            },
            "g_name": {
                "name": "商品名称",
                "check": ['noNull']
            }
        });
    });

</script>
<{if empty($goods) }>
<script type="text/javascript">
    $(function(){
//        设置选择框的宽度
        if($('.select_li').length >4){
            $('.select_ul').css('width','268px');
        }
        $('.select_div').parent().mousemove(function(){
            $('.select_ul').show();
            $('.select_div').addClass('select_div_bottom');
        }).mouseout(function(){
            $('.select_ul').hide();
            $('.select_div').removeClass('select_div_bottom');
        });
        //选择商品类型
        $('.select_li').click(function(){
            $('.select_div').html($(this).html());
            $('.select_ul').hide();
            $('#attr').children().remove();
            $('#price').children().remove();
            $('#gt_id').val($(this).attr('value'));
            $.getJSON('<{$HTTP_MODEL}>/server/goodsTypeInfoSer.php',{'gt_id':$(this).attr('value')},function(data){
                $('#gt_number').html(data['gt_number']);
                for(var j in data['attr']){
                    var attr = $('#goods_attr_list_template').clone();
                    attr.removeAttr('id');
                    attr.children('input').attr('id','attr'+j).attr('name','attr'+j);
                    attr.children('label').attr('for','attr'+j).html(data['attr'][j]);
                    $('#attr').append(attr);
                }
                for(var i in data['price']){
                    var price = $('#goods_price_list_template').clone();
                    price.removeAttr('id');
                    price.children('div').attr('id','price'+i);
                    price.children('label').html(data['price'][i]);
                    $('#price').append(price);
                }
                $('.input_label_value').focus();
            });

        });

    });
</script>
<{/if}>
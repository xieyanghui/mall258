<style type="text/css">
    div#adminAuthList >ul >li.showlistle > span:first-child {
        width: 100px;
    }

    div#adminAuthList >ul >li.showlistle > span:nth-child(2) {
        width: 200px;
    }
    div#addAdminAuth >div{
        width :400px;
    }
    div#addAdminAuth > div.autoRow{
        height: auto;
        overflow: hidden;
    }
    div.searchtext>input[type='text']{
        width: 100px;
    }
 </style>
<{if $pages['count'] ge 1 }>
<div id='adminAuthList' class='wins showwin'>
    <span >管理员权限</span>
    <ul >
        <li class='showlistle'><span >权限名</span><span >备注</span></li>
        <{section name=index loop=$row}>
        <li class='showlistle showListCons '><span title="<{$row[index]['aa_nick']}>"><{$row[index]['aa_nick']}></span><span
                title="<{$row[index]['aa_remark']}>"><{$row[index]['aa_remark']}></span><span class ="delete" value = "<{$row[index]['aa_id']}>">×</span></li>
        <{/section}>
        <{if $pages['count'] ge $pages['pageRow']+1}>
        <li class="showlistle">
            <div class = "<{if $pages['page'] ge 1}> pages button <{else}> pagesoff <{/if}>">上一页</div>

            <{section name=loop loop=$pages['pagess']}>
            <div class = "<{if $pages['start']+$smarty.section.loop.index eq $pages['page']}>
             pageis<{/if}>  pageSum button "><{$pages['start']+$smarty.section.loop.index+1 }></div>
            <{/section}>
            <div class = "<{if $pages['page']+1 lt $pages['countRow']}> pages button <{else}> pagesoff <{/if}>">下一页</div>

        </li>
        <{/if}>
        <li class="showlistle">
            <div class = "searchtext"><input  type="text" class="forms" value="<{$pages['search']}>" > </div><div class = "search button">搜索</div><div id = "searchDelete" class ="delete">×</div> <div class = "pageRow" ><div>每页显示</div><span>3</span> <span>10</span><span>15</span><span>20</span></div>
        </li>
    </ul>
</div>

<{/if}>
<form action="./server/adminAuthAdd.php" method="post" id = "addAdminAuthForm">
    <div id='addAdminAuth' class='wins showwin'>
        <span>添加级别组</span>
        <div>
            <lable>级别组名</lable>
            <div><input type="text" name="aaNick" class="forms"/></div>
        </div>
        <div>
            <lable>级别备注</lable>
            <div><input type="text" name="aaRemark" class="forms"/></div>
        </div>
        <div class = "autoRow">
            <lable>级别权限</lable>
            <div>
            <{section name=index loop=$authList}>
            <label title="<{$authList[index]['al_remark']}>"><input name="auths[]" type="checkbox" value="<{$authList[index]['al_id']}>" /><{$authList[index]['al_nick']}> </label>
            <{/section}>
            </div>
        </div>

        <div>
            <div class="submit button">提交</div>
        </div>
    </div>
</form>
<script type="text/javascript">
    function succ(data) {
        //alert(data);
        toast(data.status, data.megs);
        $('#contents').load('./inc/sysAuth.php');
    }
    function bs() {
    }
    $(function () {
        //新增权限组提交
        $('.submit').click(function () {
            $(this).parents("form").submit();
        });
        $.checks.checkform($('#addAdminAuthForm'), {
            "async": {'success': succ, 'beforeSend': bs},
            "aaNick": {
                "name": "级别名",
                "check": [ {"isLength": [2,10]}, {"isAjax": ["/server/iskeySer.php"]}]
            }
        });

        //排序
        $("li.showlistle:first > span").click(function(){
            var $sort ="ASC";
            if($(this).html() ==$("#sortCache").attr("sortLine")){
                if($("#sortCache").val()=="ASC"){
                    $sort = "DESC";
                    $("#sortCache").val("DESC");
                }else{
                    $("#sortCache").val("ASC");
                }
            }else{
                $("#sortCache").attr("sortLine",$(this).html());
                $("#sortCache").val("ASC");
            }
            $('#contents').load('./inc/sysAuth.php?sort='+$sort+'&sortLine='+$(this).html());
        });
        //权限组列表搜索
        $("li.showlistle >div.search").click(function(){
            $('#contents').load('./inc/sysAuth.php?page=0&search='+$(".searchtext >input[type='text']").val());
        });
        //权限组列表取消搜索
        $("li.showlistle >div#searchDelete").click(function(){
            $('#contents').load('./inc/sysAuth.php?page=0&searchDelete=true');
        });
        //权限组列表每页多少汗设置
        $("li.showlistle >div.pageRow>span").click(function(){
            $('#contents').load('./inc/sysAuth.php?page=0&pageRow='+$(this).html());
        });
        //权限组列表选页
        $("li.showlistle >div.pageSum").click(function(){
            $('#contents').load('./inc/sysAuth.php?page='+(parseInt($(this).html())-1));
        });
        //权限组列表翻页
        $("li.showlistle >div.pages").click(function(){
            if($(this).html() == "下一页"){
                $('#contents').load('./inc/sysAuth.php?page='+(parseInt($("li.showlistle >div.pageis").html())));
            }else{
                $('#contents').load('./inc/sysAuth.php?page='+(parseInt($("li.showlistle >div.pageis").html())-2));
            }
        });
        //权限组详情
        $("li.showListCons").click(function () {
            $.get("./inc/sysAuthUpdate.php", {'name': $(this).children('span.delete').attr("value")}, function (data) {
                $("body").append(data);
                $('#sysAuthUpdatewin').slideDown(500);
            });
        });

        //删除权限组
        $("li.showListCons >span.delete").click(function (e) {
            $slfe = $(this);
            showdielogue("删除权限组","确定要删除该权限组吗？删除之后该权限组的所有管理员都将丧失所有权限",function(){
                $.get("./server/adminAuthDelete.php",{'name':$slfe.attr("value")},function(data){
                    //alert(data);
                    toast(data.status,data.megs);
                    $("#contents").load("./inc/sysAuth.php");
                },"json");
            });
            e.stopPropagation();
        });
    });
</script>
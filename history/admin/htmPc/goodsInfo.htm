<style type="text/css">
    div#goodsList > ul > li.showlistle > span:first-child {
        width: 120px;
    }

    div#goodsList > ul > li.showlistle > span:nth-child(2) {
        width: 120px;
    }

    div#goodsList > ul > li.showlistle > span:nth-child(3) {
        width: 100px;
    }
    div#goodsList > ul > li.showlistle > span:nth-child(4) {
        width: 100px;
    }
    div#goodsList > ul > li.showlistle > span:nth-child(5) {
        width: 120px;
    }

    /*div#addAdmin > div {*/
    /*width: 400px;*/
    /*}*/

    div#addGoods > div.autoRow {
    height: auto;
    overflow: hidden;
    }


    /*div#adminHead {*/
    /*height: 75px;*/
    /*}*/

    /*div#adminHead > div {*/
    /*margin-left: 15px;*/

    /*}*/

    /*div#adminHead > div > div {*/
    /*position: static;*/
    /*float: left;*/
    /*}*/

    /*div#adminHead > div > div#imgUp {*/
    /*width: 80px;*/
    /*height: 30px;*/
    /*margin: 20px 10px;*/
    /*line-height: 30px;*/
    /*font-size: 15px;*/
    /*}*/
    div.autoRow > div#gAttr >div{
        border: 1px solid #80E5F0;
        margin: 2px 0 0 2px;
        height: 20px;
        width: 100px;
        float: left;
        padding-top: 4px;
    }
    div.autoRow > div#gAttr >div >input{
        width: 50px;
        border: 0;
        outline:none;
        float: right;
    }
    div.autoRow > div#gAttr >div >label{
        width: 50px;
        height: 22px;
        display:block;
        white-space:nowrap;
        float: left;
        color: #07A1B1;
        text-align: right;
        overflow: hidden;
    }
    div.autoRow > div#gPrice >div >label{
        width: 50px;
        height: 22px;
        line-height: 22px;
        display:block;
        white-space:nowrap;
        float: left;
        color: #07A1B1;
        text-align: right;
        overflow: hidden;
    }
    div.autoRow > div#gPrice >div >input{
        width: 50px;
        height: 18px;
        display: block;
        float: left;
        border: 1px solid #80E5F0;
        margin: 2px 0 0 2px;
    }
    div.autoRow > div#gPrice >div >div{
        width: 50px;
        height: 18px;
        line-height: 18px;
        display: block;
        float: left;
        border: 1px solid #80E5F0;
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        margin: 2px 0 0 2px;
    }
    div.autoRow > div#gPrice >div{
        border: 1px solid #80E5F0;
        width: 204px;
        height: auto;
        overflow: hidden;
        margin: 2px 0 0 2px;
    }
</style>
<{if $pages['count'] ge 1 }>
<div id='goodsList' class='wins showwin'>
    <span>商品列表</span>
    <ul>
        <li class='showlistle'>
            <span>商品编号</span>
            <span>商品名</span>
            <span>所属类型</span>
            <span>状态</span>
            <span>添加时间</span>
        </li>
        <{section name=index loop=$row}>
        <li class='showlistle showListCons '>
            <span title="<{$row[index]['g_number']}>"><{$row[index]['g_number']}></span>
            <span title="<{$row[index]['g_name']}>"><{$row[index]['g_name']}></span>
            <span title="<{$row[index]['gt_name']}>"><{$row[index]['gt_name']}></span>
            <span title="<{$row[index]['g_status']}>"><{$row[index]['g_status']}></span>
            <span title="<{$row[index]['g_reg']}>"><{$row[index]['g_reg']}></span>
            <span class="delete" value="<{$row[index]['g_id']}>">×</span>
        </li>
        <{/section}>

        <{if $pages['count'] ge $pages['pageRow']+1}>
        <li class="showlistle">
            <div class="<{if $pages['page'] ge 1}> pages button <{else}> pagesoff <{/if}>">上一页</div>
            <{section name=loop loop=$pages['pagess']}>
            <div class="<{if $pages['start']+$smarty.section.loop.index eq $pages['page']}>
                pageis<{/if}>  pageSum button "><{$pages['start']+$smarty.section.loop.index+1 }>
            </div>
            <{/section}>
            <div class="<{if $pages['page']+1 lt $pages['countRow']}> pages button <{else}> pagesoff <{/if}>">下一页</div>
        </li>
        <{/if}>
        <li class="showlistle">
            <div class="searchtext">
                <input type="text" class="forms" value="<{$pages['search']['key']}>">
                <select id="seacrhSelect">
                    <option>商品编号</option>
                    <option>商品名</option>
                    <option>所属类型</option>
                    <option>状态</option>
                    <option>添加时间</option>
                </select>
            </div>
            <div class="search button">搜索</div>
            <div id="searchDelete" class="delete">×</div>
            <div class="pageRow">
                <div>每页显示</div>
                <span>3</span>
                <span>10</span>
                <span>15</span>
                <span>20</span>
            </div>
        </li>
    </ul>
</div>
<{/if}>

<form action="./server/goodsAdd.php" method="post" id="addGoodsForm">
    <div id='addGoods' class='wins showwin'>
        <span>添加商品</span>

        <div>
            <label>商品名</label>
            <div><input  type="text" name="goodsName" class="forms"/></div>
        </div>
        <div>
            <label>商品类别</label>
            <div>
                <select class="typeSelect forms">
                    <{section name=index loop=$goodsTypeList}>
                    <option value="<{$goodsTypeList[index]['gt_id']}>"><{$goodsTypeList[index]['gt_name']}></option>
                    <{/section}>
                </select>
            </div>
        </div>
        <div>
            <label>商品编号</label>
            <div><input  type="type" name="goodsNumber" class="forms"/></div>
        </div>
        <div class = "updateImg">
            <label>商品图片</label>
            <div>
                <div id="adminHeadImg">
                    <img src="http://7xkkh3.com1.z0.glb.clouddn.com/guest.png?imageView2/2/w/50/h/50"/>
                    <input  type="hidden" name="img"/>
                </div>
                <div id="imgUp" class="button">选择图片</div>
            </div>
        </div>
        <div class="autoRow">
            <label>详细属性</label>
            <div id ="gAttr">

            </div>
        </div>
        <div class="autoRow">
            <label>商品价格</label>
            <div id = "gPrice">

            </div>
        </div>

        <div>
            <div class="submit button">提交</div>
        </div>
    </div>
</form>
<script type="text/javascript" src="<{$HTTP_HOST}>/js/upload.js"></script>
<script type="text/javascript">
    function succ(data) {
        //alert(data);
        toast(data.status, data.megs);
        $('#contents').load('./inc/sysAdmin.php');
    }
    function bs() {
    }

    $(function () {
        typeSelect();
        function typeSelect(){
            $.get("./server/goodsTypeInfo.php?gtId="+$('.typeSelect').val(),function(data){
                $("#gAttr").html("");
                $("#gPrice").html("");
                for(var attr in data.gt_attr){
                    $("#gAttr").append("<div title='"+data.gt_attr[attr].gta_name+"'><label>"+data.gt_attr[attr].gta_name+"</label><input name='attr"+data.gt_attr[attr].gta_id+"'  /></div>");
                }
                for(var price in data.gt_attrPrice){
                    $("#gPrice").append("<div title='"+data.gt_attrPrice[price].gtap_name+"'><label>"+data.gt_attrPrice[price].gtap_name+":</label><input  name='price"+data.gt_attrPrice[price].gtap_id+"[]'  /><div class = 'addPrice'>+</div></div>");
                }
                $(".addPrice").click(function(){
                    $(this).before("<input name='"+$(this).parent().attr("name")+"[]' />");
                });
            },"json");
            $("div#gPrice >div >input").blur(function(){

            });
        }



        $('.typeSelect').change(typeSelect);
        //新增管理员提交
        $('.submit').click(function () {
            $(this).parents("form").submit();
        });

        //验证
        $.checks.checkform($('#addAdminForm'), {
            "async": {'success': succ, 'beforeSend': bs},
            "aName": {
                "name": "登录名",
                "check": ["noSpechars", {"isLength": [4, 20]}, {"isAjax": ["/server/iskeySer.php"]}]
            }, "aNick": {
                "name": "姓名",
                "check": [{"isLength": [2, 20]}]
            }
        });


        //排序
        $("li.showlistle:first > span").click(function () {
            var $sort = "ASC";
            if ($(this).html() == $("#sortCache").attr("sortLine")) {
                if ($("#sortCache").val() == "ASC") {
                    $sort = "DESC";
                    $("#sortCache").val("DESC");
                } else {
                    $("#sortCache").val("ASC");
                }
            } else {
                $("#sortCache").attr("sortLine", $(this).html());
                $("#sortCache").val("ASC");
            }
            $('#contents').load('<{$thispath}>?sort=' + $sort + '&sortLine=' + $(this).html());
        });

        //列表搜索
        $("li.showlistle >div.search").click(function () {
            $('#contents').load('<{$thispath}>?page=0&searchLine='+$("#seacrhSelect").val()+'&search='+$(".searchtext >input[type='text']").val());
        });

        //列表取消搜索
        $("li.showlistle >div#searchDelete").click(function () {
            $('#contents').load('<{$thispath}>?page=0&searchDelete=true');
        });
        //列表每页多少汗设置
        $("li.showlistle >div.pageRow>span").click(function () {
            $('#contents').load('<{$thispath}>?page=0&pageRow=' + $(this).html());
        });
        //列表选页
        $("li.showlistle >div.pageSum").click(function () {
            $('#contents').load('<{$thispath}>?page=' + (parseInt($(this).html()) - 1));
        });
        //列表翻页
        $("li.showlistle >div.pages").click(function () {
            if ($(this).html() == "下一页") {
                $('#contents').load('<{$thispath}>?page=' + (parseInt($("li.showlistle >div.pageis").html())));
            } else {
                $('#contents').load('<{$thispath}>?page=' + (parseInt($("li.showlistle >div.pageis").html()) - 2));
            }
        });
        //管理员详情
        $("li.showListCons").click(function () {
            $.get("./inc/sysAdminUpdate.php", {'name': $(this).children('span.delete').attr("value")}, function (data) {
                $("body").append(data);
                $('#sysAdminUpdatewin').slideDown(500);
            });
        });

        //删除管理员
        $("li.showListCons >span.delete").click(function (e) {
            $slfe = $(this);
            showdielogue("删除权限组", "确定要删除该权限组吗？删除之后该权限组的所有管理员都将丧失所有权限", function () {
                $.get("./server/adminDelete.php", {'name': $slfe.attr("value")}, function (data) {
                    //alert(data);
                    toast(data.status, data.megs);
                    $("#contents").load("<{$thispath}>");
                }, "json");
            });
            e.stopPropagation();
        });


        //上传头像
        var up = uploads.getUplad();
        up.browse_button = "imgUp";
        //up.container = "adminHeadImg";
        up['init'].FileUploaded = function (up, file, info) {
            var domain = up.getOption('domain');
            var res = JSON.parse(info);
            $("#adminHeadImg>img").attr("src", domain + "/" + res.key + "?imageMogr2/thumbnail/75x75");
            $("#adminHeadImg>input[name='img']").val(domain + "/" + res.key);
        };
        var uploader = Qiniu.uploader(up);
    });
</script>
 